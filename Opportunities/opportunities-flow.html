<link rel="stylesheet" href="../Opportunities/opportunities-flow.css">

<!-- Opportunities Process Section -->
<div class="opportunities-section">
    <div class="section-header">
        <h2>Add an Attachment Opportunity</h2>
    </div>

    <!-- Add Opportunity Form -->
    <div id="opportunityFormContainer" style="display: none; margin-bottom: 30px;">
        <!-- Alert Messages -->
        <div id="alertContainer"></div>
        
        <div class="opportunity-form-card">
            <div class="form-header">
                <h3><i class="fas fa-plus-circle"></i> Add New Attachment Opportunity</h3>
                <button type="button" class="close-form-btn" onclick="toggleOpportunityForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="opportunityForm" method="POST" action="../Opportunities/process-add-opportunity.php">
                <!-- Hidden host_org_id field (for admin) -->
                <input type="hidden" id="hostOrgId" name="host_org_id" value="">
                
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="description" class="form-label">
                            <i class="fas fa-file-alt"></i> Opportunity Description
                        </label>
                        <textarea 
                            id="description" 
                            name="description" 
                            class="form-control" 
                            placeholder="Describe the attachment opportunity (role, tasks, responsibilities)" 
                            rows="4"
                            required>
                        </textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="eligibilityCriteria" class="form-label">
                            <i class="fas fa-graduation-cap"></i> Eligibility Criteria
                        </label>
                        <textarea 
                            id="eligibilityCriteria" 
                            name="eligibility_criteria" 
                            class="form-control" 
                            placeholder="Specify requirements (e.g., course, year of study, GPA)" 
                            rows="3"
                            required>
                        </textarea>
                    </div>

                    <div class="form-group">
                        <label for="applicationStartDate" class="form-label">
                            <i class="fas fa-calendar-alt"></i> Application Start Date
                        </label>
                        <input 
                            type="date" 
                            id="applicationStartDate" 
                            name="application_start_date" 
                            class="form-control" 
                            required>
                    </div>

                    <div class="form-group">
                        <label for="applicationEndDate" class="form-label">
                            <i class="fas fa-calendar-alt"></i> Application End Date
                        </label>
                        <input 
                            type="date" 
                            id="applicationEndDate" 
                            name="application_end_date" 
                            class="form-control" 
                            required>
                    </div>

                    <div class="form-group">
                        <label for="status" class="form-label">
                            <i class="fas fa-check-circle"></i> Status
                        </label>
                        <select id="status" name="status" class="form-control" required>
                            <option value="">Select Status</option>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                            <option value="Closed">Closed</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="numberOfPositions" class="form-label">
                            <i class="fas fa-users"></i> Number of Positions Available
                        </label>
                        <input 
                            type="number" 
                            id="numberOfPositions" 
                            name="number_of_positions" 
                            class="form-control" 
                            placeholder="How many students can be attached?" 
                            min="1"
                            required>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Add Opportunity
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="toggleOpportunityForm()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Opportunity Button -->
    <div style="margin-bottom: 20px;">
        <button type="button" class="btn btn-primary" onclick="toggleOpportunityForm()">
            <i class="fas fa-plus"></i> Add New Opportunity
        </button>
    </div>

   
<script>
    function toggleOpportunityForm() {
        const formContainer = document.getElementById('opportunityFormContainer');
        if (formContainer.style.display === 'none' || formContainer.style.display === '') {
            formContainer.style.display = 'block';
            document.getElementById('description').focus();
        } else {
            formContainer.style.display = 'none';
            document.getElementById('opportunityForm').reset();
        }
    }

    // Form submission with validation
    document.getElementById('opportunityForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const startDate = new Date(document.getElementById('applicationStartDate').value);
        const endDate = new Date(document.getElementById('applicationEndDate').value);
        
        if (startDate >= endDate) {
            displayAlert('error', 'Application end date must be after start date');
            return;
        }
        
        // Submit the form
        this.submit();
    });

    function displayAlert(type, message) {
        const container = document.getElementById('alertContainer');
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        
        const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
        
        alertDiv.innerHTML = `
            <i class="${icon}"></i>
            <span>${message}</span>
            <button type="button" class="alert-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        container.appendChild(alertDiv);
        
        // Auto-dismiss success alerts after 5 seconds
        if (type === 'success') {
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    }

    // Auto-hide form on page load and check for session messages
    document.addEventListener('DOMContentLoaded', function() {
        const formContainer = document.getElementById('opportunityFormContainer');
        if (formContainer) {
            formContainer.style.display = 'none';
        }

        // Check for session messages
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('success')) {
            displayAlert('success', 'Opportunity added successfully!');
        }
        if (urlParams.has('error')) {
            const error = urlParams.get('error');
            displayAlert('error', decodeURIComponent(error));
        }
    });
</script>
